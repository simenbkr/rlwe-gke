#include <stdint.h>
#include "params.h"
#include "common.h"
#include "fft.h"


/**
 * Table stolen from some other RLWE implementation. Can't remember which... ¯\_(ツ)_/¯.
 */
static uint16_t bitrev_table[1024] = {
        0,512,256,768,128,640,384,896,64,576,320,832,192,704,448,960,32,544,288,800,160,672,416,928,96,608,352,864,224,736,480,992,
        16,528,272,784,144,656,400,912,80,592,336,848,208,720,464,976,48,560,304,816,176,688,432,944,112,624,368,880,240,752,496,1008,
        8,520,264,776,136,648,392,904,72,584,328,840,200,712,456,968,40,552,296,808,168,680,424,936,104,616,360,872,232,744,488,1000,
        24,536,280,792,152,664,408,920,88,600,344,856,216,728,472,984,56,568,312,824,184,696,440,952,120,632,376,888,248,760,504,1016,
        4,516,260,772,132,644,388,900,68,580,324,836,196,708,452,964,36,548,292,804,164,676,420,932,100,612,356,868,228,740,484,996,
        20,532,276,788,148,660,404,916,84,596,340,852,212,724,468,980,52,564,308,820,180,692,436,948,116,628,372,884,244,756,500,1012,
        12,524,268,780,140,652,396,908,76,588,332,844,204,716,460,972,44,556,300,812,172,684,428,940,108,620,364,876,236,748,492,1004,
        28,540,284,796,156,668,412,924,92,604,348,860,220,732,476,988,60,572,316,828,188,700,444,956,124,636,380,892,252,764,508,1020,
        2,514,258,770,130,642,386,898,66,578,322,834,194,706,450,962,34,546,290,802,162,674,418,930,98,610,354,866,226,738,482,994,
        18,530,274,786,146,658,402,914,82,594,338,850,210,722,466,978,50,562,306,818,178,690,434,946,114,626,370,882,242,754,498,1010,
        10,522,266,778,138,650,394,906,74,586,330,842,202,714,458,970,42,554,298,810,170,682,426,938,106,618,362,874,234,746,490,1002,
        26,538,282,794,154,666,410,922,90,602,346,858,218,730,474,986,58,570,314,826,186,698,442,954,122,634,378,890,250,762,506,1018,
        6,518,262,774,134,646,390,902,70,582,326,838,198,710,454,966,38,550,294,806,166,678,422,934,102,614,358,870,230,742,486,998,
        22,534,278,790,150,662,406,918,86,598,342,854,214,726,470,982,54,566,310,822,182,694,438,950,118,630,374,886,246,758,502,1014,
        14,526,270,782,142,654,398,910,78,590,334,846,206,718,462,974,46,558,302,814,174,686,430,942,110,622,366,878,238,750,494,1006,
        30,542,286,798,158,670,414,926,94,606,350,862,222,734,478,990,62,574,318,830,190,702,446,958,126,638,382,894,254,766,510,1022,
        1,513,257,769,129,641,385,897,65,577,321,833,193,705,449,961,33,545,289,801,161,673,417,929,97,609,353,865,225,737,481,993,
        17,529,273,785,145,657,401,913,81,593,337,849,209,721,465,977,49,561,305,817,177,689,433,945,113,625,369,881,241,753,497,1009,
        9,521,265,777,137,649,393,905,73,585,329,841,201,713,457,969,41,553,297,809,169,681,425,937,105,617,361,873,233,745,489,1001,
        25,537,281,793,153,665,409,921,89,601,345,857,217,729,473,985,57,569,313,825,185,697,441,953,121,633,377,889,249,761,505,1017,
        5,517,261,773,133,645,389,901,69,581,325,837,197,709,453,965,37,549,293,805,165,677,421,933,101,613,357,869,229,741,485,997,
        21,533,277,789,149,661,405,917,85,597,341,853,213,725,469,981,53,565,309,821,181,693,437,949,117,629,373,885,245,757,501,1013,
        13,525,269,781,141,653,397,909,77,589,333,845,205,717,461,973,45,557,301,813,173,685,429,941,109,621,365,877,237,749,493,1005,
        29,541,285,797,157,669,413,925,93,605,349,861,221,733,477,989,61,573,317,829,189,701,445,957,125,637,381,893,253,765,509,1021,
        3,515,259,771,131,643,387,899,67,579,323,835,195,707,451,963,35,547,291,803,163,675,419,931,99,611,355,867,227,739,483,995,
        19,531,275,787,147,659,403,915,83,595,339,851,211,723,467,979,51,563,307,819,179,691,435,947,115,627,371,883,243,755,499,1011,
        11,523,267,779,139,651,395,907,75,587,331,843,203,715,459,971,43,555,299,811,171,683,427,939,107,619,363,875,235,747,491,1003,
        27,539,283,795,155,667,411,923,91,603,347,859,219,731,475,987,59,571,315,827,187,699,443,955,123,635,379,891,251,763,507,1019,
        7,519,263,775,135,647,391,903,71,583,327,839,199,711,455,967,39,551,295,807,167,679,423,935,103,615,359,871,231,743,487,999,
        23,535,279,791,151,663,407,919,87,599,343,855,215,727,471,983,55,567,311,823,183,695,439,951,119,631,375,887,247,759,503,1015,
        15,527,271,783,143,655,399,911,79,591,335,847,207,719,463,975,47,559,303,815,175,687,431,943,111,623,367,879,239,751,495,1007,
        31,543,287,799,159,671,415,927,95,607,351,863,223,735,479,991,63,575,319,831,191,703,447,959,127,639,383,895,255,767,511,1023
};

static const uint64_t omega[1024] = {0, 1, 1, 7350412184, 1, 7350412184, 34320582150, 15675532427, 1, 7350412184,
                                34320582150,
                                15675532427, 31034634912, 37290234217, 44889369015, 21632238305, 1, 7350412184,
                                34320582150, 15675532427, 31034634912, 37290234217, 44889369015, 21632238305,
                                17444836549,
                                8370921996, 32865737229, 43048872938, 20900766087, 34884398330, 34082181455,
                                44882008906,
                                1, 7350412184, 34320582150, 15675532427, 31034634912, 37290234217, 44889369015,
                                21632238305,
                                17444836549, 8370921996, 32865737229, 43048872938, 20900766087, 34884398330,
                                34082181455,
                                44882008906, 36271791672, 42429751981, 23154018116, 45260674623, 35294324248,
                                17713586590,
                                7612371546, 24587743612, 34699234503, 6347365412, 27346263310, 32833106956, 27485408016,
                                10566541317, 1084494767, 26310190793, 1, 7350412184, 34320582150, 15675532427,
                                31034634912,
                                37290234217, 44889369015, 21632238305, 17444836549, 8370921996, 32865737229,
                                43048872938,
                                20900766087, 34884398330, 34082181455, 44882008906, 36271791672, 42429751981,
                                23154018116,
                                45260674623, 35294324248, 17713586590, 7612371546, 24587743612, 34699234503, 6347365412,
                                27346263310, 32833106956, 27485408016, 10566541317, 1084494767, 26310190793,
                                40262948345,
                                27145094160, 28374846185, 5503808536, 21323335890, 25740023996, 40490036405,
                                33103925375,
                                16387480215, 27910971664, 45090508768, 5279879672, 32528581889, 34795975187,
                                42682158523,
                                26792972116, 33598047918, 10985122659, 33804953035, 36573966836, 6703212575,
                                16203900721,
                                35839857934, 7047246149, 29239152932, 7818962923, 14229575579, 20374651432, 37183102558,
                                326861783, 24068003370, 15438733859, 1, 7350412184, 34320582150, 15675532427,
                                31034634912,
                                37290234217, 44889369015, 21632238305, 17444836549, 8370921996, 32865737229,
                                43048872938,
                                20900766087, 34884398330, 34082181455, 44882008906, 36271791672, 42429751981,
                                23154018116,
                                45260674623, 35294324248, 17713586590, 7612371546, 24587743612, 34699234503, 6347365412,
                                27346263310, 32833106956, 27485408016, 10566541317, 1084494767, 26310190793,
                                40262948345,
                                27145094160, 28374846185, 5503808536, 21323335890, 25740023996, 40490036405,
                                33103925375,
                                16387480215, 27910971664, 45090508768, 5279879672, 32528581889, 34795975187,
                                42682158523,
                                26792972116, 33598047918, 10985122659, 33804953035, 36573966836, 6703212575,
                                16203900721,
                                35839857934, 7047246149, 29239152932, 7818962923, 14229575579, 20374651432, 37183102558,
                                326861783, 24068003370, 15438733859, 36043823599, 10262130362, 18961021569, 37016806306,
                                36918726885, 21602714922, 23912981719, 9053801453, 42988285392, 14354680206,
                                24996580140,
                                10341133512, 11748779869, 39738392561, 26115748427, 3054844502, 12190645581,
                                31399190212,
                                11190384924, 30408264960, 12505208054, 40363805388, 33324500437, 24039089730,
                                34849465847,
                                30562673358, 14594037846, 19269094605, 37836419261, 7053710310, 32460992290,
                                40254884696,
                                26316149918, 27576357412, 23310267231, 8353260746, 20286517379, 41341014969, 1872024279,
                                7183713673, 41104060384, 8040223664, 40756184097, 19294229114, 21341321151, 14939244914,
                                24844607170, 16493205628, 11762664450, 45420009740, 16025286287, 17759715991,
                                4851036858,
                                11587995845, 38208632714, 43058009335, 37087458194, 26982673743, 34922423634,
                                37358494807,
                                34774825046, 33006877576, 44522039193, 10440682908, 1, 7350412184, 34320582150,
                                15675532427,
                                31034634912, 37290234217, 44889369015, 21632238305, 17444836549, 8370921996,
                                32865737229,
                                43048872938, 20900766087, 34884398330, 34082181455, 44882008906, 36271791672,
                                42429751981,
                                23154018116, 45260674623, 35294324248, 17713586590, 7612371546, 24587743612,
                                34699234503,
                                6347365412, 27346263310, 32833106956, 27485408016, 10566541317, 1084494767, 26310190793,
                                40262948345, 27145094160, 28374846185, 5503808536, 21323335890, 25740023996,
                                40490036405,
                                33103925375, 16387480215, 27910971664, 45090508768, 5279879672, 32528581889,
                                34795975187,
                                42682158523, 26792972116, 33598047918, 10985122659, 33804953035, 36573966836,
                                6703212575,
                                16203900721, 35839857934, 7047246149, 29239152932, 7818962923, 14229575579, 20374651432,
                                37183102558, 326861783, 24068003370, 15438733859, 36043823599, 10262130362, 18961021569,
                                37016806306, 36918726885, 21602714922, 23912981719, 9053801453, 42988285392,
                                14354680206,
                                24996580140, 10341133512, 11748779869, 39738392561, 26115748427, 3054844502,
                                12190645581,
                                31399190212, 11190384924, 30408264960, 12505208054, 40363805388, 33324500437,
                                24039089730,
                                34849465847, 30562673358, 14594037846, 19269094605, 37836419261, 7053710310,
                                32460992290,
                                40254884696, 26316149918, 27576357412, 23310267231, 8353260746, 20286517379,
                                41341014969,
                                1872024279, 7183713673, 41104060384, 8040223664, 40756184097, 19294229114, 21341321151,
                                14939244914, 24844607170, 16493205628, 11762664450, 45420009740, 16025286287,
                                17759715991,
                                4851036858, 11587995845, 38208632714, 43058009335, 37087458194, 26982673743,
                                34922423634, 37358494807, 34774825046, 33006877576, 44522039193, 10440682908,
                                3316187664, 15049211702, 23563506367, 18757274555, 9217120226, 27012052188, 31220703151,
                                23916105669, 9299527990, 24055571249, 633108601, 4602465000, 39896044161, 43448010450,
                                38942796561, 14566788565, 13936688805, 31145352725, 23338080382, 8210686135,
                                18991811697, 1642870901, 25173945319, 6146215956, 26448002607, 25534439577, 22230635341,
                                6033333813, 19222151587, 19317291355, 11162732840, 41380978173, 18680863797,
                                18633372593, 45405077971, 13112177585, 24881366532, 42722366970, 13406945843,
                                37789494872, 43805388162, 5746128461, 31340769369, 4478635065, 6630928063, 6118300394,
                                40055244445, 3200873228, 30838835589, 9125659474, 21838850149, 22529554442, 36683165407,
                                21038713017, 5743597701, 7701727339, 36203224442, 330019668, 31748936229, 6309189242,
                                1125780441, 19448954457, 39957256313, 10099859190, 16338165843, 20793804138,
                                25714725372, 26398805564, 1852781950, 43144272331, 35545872959, 38962921015,
                                29900755652, 32248511968, 37482805481, 44554152714, 16440304009, 9179047912,
                                26907085743, 14747549273, 20462769414, 36792421391, 688887696, 44751711797, 39915692375,
                                19296627637, 42587697102, 25105838048, 24100825017, 2972465324, 11443738684, 1699923359,
                                41922627946, 15181563018, 39393884503, 3220531036, 23937189148, 7616609097, 20316100054,
                                4419628574, 22327537770, 973344285, 30195870540, 18577955048, 14234981553, 27570271887,
                                13694281052, 34398505015, 33909723021, 36852141860, 22983317370, 16157263977,
                                26571425223, 16759570123, 39518049011, 12198473694, 37540130063, 18678992175,
                                23572362842, 25455463721, 9786367760, 5465660558, 23453103333, 4262484535, 2940553529,
                                30672394327, 22489869726, 20342993102, 1, 7350412184, 34320582150, 15675532427,
                                31034634912, 37290234217, 44889369015, 21632238305, 17444836549, 8370921996,
                                32865737229, 43048872938, 20900766087, 34884398330, 34082181455, 44882008906,
                                36271791672, 42429751981, 23154018116, 45260674623, 35294324248, 17713586590,
                                7612371546, 24587743612, 34699234503, 6347365412, 27346263310, 32833106956, 27485408016,
                                10566541317, 1084494767, 26310190793, 40262948345, 27145094160, 28374846185, 5503808536,
                                21323335890, 25740023996, 40490036405, 33103925375, 16387480215, 27910971664,
                                45090508768, 5279879672, 32528581889, 34795975187, 42682158523, 26792972116,
                                33598047918, 10985122659, 33804953035, 36573966836, 6703212575, 16203900721,
                                35839857934, 7047246149, 29239152932, 7818962923, 14229575579, 20374651432, 37183102558,
                                326861783, 24068003370, 15438733859, 36043823599, 10262130362, 18961021569, 37016806306,
                                36918726885, 21602714922, 23912981719, 9053801453, 42988285392, 14354680206,
                                24996580140, 10341133512, 11748779869, 39738392561, 26115748427, 3054844502,
                                12190645581, 31399190212, 11190384924, 30408264960, 12505208054, 40363805388,
                                33324500437, 24039089730, 34849465847, 30562673358, 14594037846, 19269094605,
                                37836419261, 7053710310, 32460992290, 40254884696, 26316149918, 27576357412,
                                23310267231, 8353260746, 20286517379, 41341014969, 1872024279, 7183713673, 41104060384,
                                8040223664, 40756184097, 19294229114, 21341321151, 14939244914, 24844607170,
                                16493205628, 11762664450, 45420009740, 16025286287, 17759715991, 4851036858,
                                11587995845, 38208632714, 43058009335, 37087458194, 26982673743, 34922423634,
                                37358494807, 34774825046, 33006877576, 44522039193, 10440682908, 3316187664,
                                15049211702, 23563506367, 18757274555, 9217120226, 27012052188, 31220703151,
                                23916105669, 9299527990, 24055571249, 633108601, 4602465000, 39896044161, 43448010450,
                                38942796561, 14566788565, 13936688805, 31145352725, 23338080382, 8210686135,
                                18991811697, 1642870901, 25173945319, 6146215956, 26448002607, 25534439577, 22230635341,
                                6033333813, 19222151587, 19317291355, 11162732840, 41380978173, 18680863797,
                                18633372593, 45405077971, 13112177585, 24881366532, 42722366970, 13406945843,
                                37789494872, 43805388162, 5746128461, 31340769369, 4478635065, 6630928063, 6118300394,
                                40055244445, 3200873228, 30838835589, 9125659474, 21838850149, 22529554442, 36683165407,
                                21038713017, 5743597701, 7701727339, 36203224442, 330019668, 31748936229, 6309189242,
                                1125780441, 19448954457, 39957256313, 10099859190, 16338165843, 20793804138,
                                25714725372, 26398805564, 1852781950, 43144272331, 35545872959, 38962921015,
                                29900755652, 32248511968, 37482805481, 44554152714, 16440304009, 9179047912,
                                26907085743, 14747549273, 20462769414, 36792421391, 688887696, 44751711797, 39915692375,
                                19296627637, 42587697102, 25105838048, 24100825017, 2972465324, 11443738684, 1699923359,
                                41922627946, 15181563018, 39393884503, 3220531036, 23937189148, 7616609097, 20316100054,
                                4419628574, 22327537770, 973344285, 30195870540, 18577955048, 14234981553, 27570271887,
                                13694281052, 34398505015, 33909723021, 36852141860, 22983317370, 16157263977,
                                26571425223, 16759570123, 39518049011, 12198473694, 37540130063, 18678992175,
                                23572362842, 25455463721, 9786367760, 5465660558, 23453103333, 4262484535, 2940553529,
                                30672394327, 22489869726, 20342993102, 42305359955, 6378700290, 13985313220,
                                26006249487, 31751253824, 14639143251, 2296600761, 22962392557, 26398393796, 42992270,
                                5845522909, 30118226805, 4755590163, 33543191167, 29045815107, 35662397772, 860969183,
                                33304029924, 8880882504, 29275197895, 24335981241, 33324005179, 25274798137,
                                39867288098, 9912714730, 41513081587, 20254659953, 16050834962, 34847650826, 7853805617,
                                23648665990, 15294146350, 28605426577, 20271566162, 27022730651, 31724037484,
                                12608920734, 17612518811, 22010606580, 37762996174, 42816202860, 35817275920,
                                4296065160, 8793840637, 1950799898, 19814066769, 31591401931, 27089506395, 1689210647,
                                10363065787, 12578580201, 4966291752, 27096398527, 30645571917, 32117960500, 3192336589,
                                6259376580, 17245520614, 10875835864, 37789909882, 40546136971, 143679329, 21921806100,
                                7128984460, 41515808579, 20685062429, 39183218354, 3008836839, 22693839377, 13839327343,
                                32109537621, 38175848817, 6541774224, 35322114481, 4191260024, 1987060906, 31467287507,
                                25495141792, 16310602334, 27987765997, 28442231005, 34343274366, 42740799393,
                                9208044805, 16620593763, 35886310779, 23892528644, 4387327388, 15954936525, 14857298299,
                                17624440029, 15920109416, 41431842581, 8100563569, 3654240021, 19857902070, 22346763407,
                                12492714372, 37134317242, 31543380329, 32762075637, 34862124639, 24528546510,
                                5884022819, 26296101056, 32538907974, 39582395568, 11708840567, 34090321834, 4750869121,
                                35770788082, 36096943417, 7060921305, 32160217879, 22416011950, 16382404508,
                                33261269535, 4693828849, 41544330228, 14241002171, 12112837043, 23065833265,
                                17910784549, 9458672055, 39208231449, 31166966311, 4948302650, 27019747126, 40806568725,
                                30288749413, 5770632425, 42714378094, 16959560021, 35749002077, 16731503378,
                                44112192732, 34094215629, 16010147755, 970123599, 17235917626, 27178849362, 3989841629,
                                11928990871, 3390236722, 42358604775, 20015145322, 8024517914, 22654589419, 39211879138,
                                40203263782, 40137673849, 5597289594, 32780884269, 34008835365, 35883894555,
                                31588395271, 3319231368, 34651637292, 34000274772, 27212236970, 11656330372,
                                23377885959, 42287951773, 23028324063, 4441873236, 12976574961, 28532954417,
                                38133022575, 14693534116, 23342630997, 37507330980, 1774004681, 29304729343,
                                10159240808, 8032474073, 40634997949, 16621499109, 43030248827, 4839674385, 27169786388,
                                4363690298, 2041770644, 30699324965, 26241152101, 34468007811, 30532520460, 43468494783,
                                34815862153, 7847246657, 5055838093, 14777287457, 6930782483, 43520426481, 10429943093,
                                42861616466, 36249448682, 38359320420, 17025887908, 11778967468, 22272874064,
                                40679139156, 11233006045, 19059943962, 42574038722, 21065794549, 570421980, 36091736644,
                                17696222099, 27767004373, 10909146929, 24548982170, 22846292041, 6728061291,
                                36834611998, 42911376581, 34309534783, 13749127935, 13755006662, 35876800728,
                                8324334536, 32315834094, 6795546016, 34442089958, 39329676686, 30562996754, 24494205538,
                                34776188858, 27269295736, 19647924465, 44055571215, 19119856362, 35562326828,
                                24942892516, 36867342815, 31243494509, 7708143457, 13375764914, 27020220155,
                                44991916707, 24777775376, 8341136693, 27019906637, 23569560392, 23742295182,
                                27392235087, 45162580423, 227473580, 9123762101, 42401933983, 16289119747, 29002108155,
                                32426673541, 25706697240, 31340657627, 23473966995, 40260866182};

static const uint64_t omega_inv[APON_N] = {0, 1, 1, 38159621225, 1, 38159621225, 29834500982, 11189451259, 1, 38159621225,
                                    29834500982, 11189451259, 23877795104, 620664394, 8219799192, 14475398497, 1,
                                    38159621225, 29834500982, 11189451259, 23877795104, 620664394, 8219799192,
                                    14475398497, 628024503, 11427851954, 10625635079, 24609267322, 2461160471,
                                    12644296180, 37139111413, 28065196860, 1, 38159621225, 29834500982, 11189451259,
                                    23877795104, 620664394, 8219799192, 14475398497, 628024503, 11427851954,
                                    10625635079, 24609267322, 2461160471, 12644296180, 37139111413, 28065196860,
                                    19199842616, 44425538642, 34943492092, 18024625393, 12676926453, 18163770099,
                                    39162667997, 10810798906, 20922289797, 37897661863, 27796446819, 10215709161,
                                    249358786, 22356015293, 3080281428, 9238241737, 1, 38159621225, 29834500982,
                                    11189451259, 23877795104, 620664394, 8219799192, 14475398497, 628024503,
                                    11427851954, 10625635079, 24609267322, 2461160471, 12644296180, 37139111413,
                                    28065196860, 19199842616, 44425538642, 34943492092, 18024625393, 12676926453,
                                    18163770099, 39162667997, 10810798906, 20922289797, 37897661863, 27796446819,
                                    10215709161, 249358786, 22356015293, 3080281428, 9238241737, 30071299550,
                                    21442030039, 45183171626, 8326930851, 25135381977, 31280457830, 37691070486,
                                    16270880477, 38462787260, 9670175475, 29306132688, 38806820834, 8936066573,
                                    11705080374, 34524910750, 11911985491, 18717061293, 2827874886, 10714058222,
                                    12981451520, 40230153737, 419524641, 17599061745, 29122553194, 12406108034,
                                    5019997004, 19770009413, 24186697519, 40006224873, 17135187224, 18364939249,
                                    5247085064, 1, 38159621225, 29834500982, 11189451259, 23877795104, 620664394,
                                    8219799192, 14475398497, 628024503, 11427851954, 10625635079, 24609267322,
                                    2461160471, 12644296180, 37139111413, 28065196860, 19199842616, 44425538642,
                                    34943492092, 18024625393, 12676926453, 18163770099, 39162667997, 10810798906,
                                    20922289797, 37897661863, 27796446819, 10215709161, 249358786, 22356015293,
                                    3080281428, 9238241737, 30071299550, 21442030039, 45183171626, 8326930851,
                                    25135381977, 31280457830, 37691070486, 16270880477, 38462787260, 9670175475,
                                    29306132688, 38806820834, 8936066573, 11705080374, 34524910750, 11911985491,
                                    18717061293, 2827874886, 10714058222, 12981451520, 40230153737, 419524641,
                                    17599061745, 29122553194, 12406108034, 5019997004, 19770009413, 24186697519,
                                    40006224873, 17135187224, 18364939249, 5247085064, 35069350501, 987994216,
                                    12503155833, 10735208363, 8151538602, 10587609775, 18527359666, 8422575215,
                                    2452024074, 7301400695, 33922037564, 40658996551, 27750317418, 29484747122,
                                    90023669, 33747368959, 29016827781, 20665426239, 30570788495, 24168712258,
                                    26215804295, 4753849312, 37469809745, 4405973025, 38326319736, 43638009130,
                                    4169018440, 25223516030, 37156772663, 22199766178, 17933675997, 19193883491,
                                    5255148713, 13049041119, 38456323099, 7673614148, 26240938804, 30915995563,
                                    14947360051, 10660567562, 21470943679, 12185532972, 5146228021, 33004825355,
                                    15101768449, 34319648485, 14110843197, 33319387828, 42455188907, 19394284982,
                                    5771640848, 33761253540, 35168899897, 20513453269, 31155353203, 2521748017,
                                    36456231956, 21597051690, 23907318487, 8591306524, 8493227103, 26549011840,
                                    35247903047, 9466209810, 1, 38159621225, 29834500982, 11189451259, 23877795104,
                                    620664394, 8219799192, 14475398497, 628024503, 11427851954, 10625635079,
                                    24609267322, 2461160471, 12644296180, 37139111413, 28065196860, 19199842616,
                                    44425538642, 34943492092, 18024625393, 12676926453, 18163770099, 39162667997,
                                    10810798906, 20922289797, 37897661863, 27796446819, 10215709161, 249358786,
                                    22356015293, 3080281428, 9238241737, 30071299550, 21442030039, 45183171626,
                                    8326930851, 25135381977, 31280457830, 37691070486, 16270880477, 38462787260,
                                    9670175475, 29306132688, 38806820834, 8936066573, 11705080374, 34524910750,
                                    11911985491, 18717061293, 2827874886, 10714058222, 12981451520, 40230153737,
                                    419524641, 17599061745, 29122553194, 12406108034, 5019997004, 19770009413,
                                    24186697519, 40006224873, 17135187224, 18364939249, 5247085064, 35069350501,
                                    987994216, 12503155833, 10735208363, 8151538602, 10587609775, 18527359666,
                                    8422575215, 2452024074, 7301400695, 33922037564, 40658996551, 27750317418,
                                    29484747122, 90023669, 33747368959, 29016827781, 20665426239, 30570788495,
                                    24168712258, 26215804295, 4753849312, 37469809745, 4405973025, 38326319736,
                                    43638009130, 4169018440, 25223516030, 37156772663, 22199766178, 17933675997,
                                    19193883491, 5255148713, 13049041119, 38456323099, 7673614148, 26240938804,
                                    30915995563, 14947360051, 10660567562, 21470943679, 12185532972, 5146228021,
                                    33004825355, 15101768449, 34319648485, 14110843197, 33319387828, 42455188907,
                                    19394284982, 5771640848, 33761253540, 35168899897, 20513453269, 31155353203,
                                    2521748017, 36456231956, 21597051690, 23907318487, 8591306524, 8493227103,
                                    26549011840, 35247903047, 9466209810, 25167040307, 23020163683, 14837639082,
                                    42569479880, 41247548874, 22056930076, 40044372851, 35723665649, 20054569688,
                                    21937670567, 26831041234, 7969903346, 33311559715, 5991984398, 28750463286,
                                    18938608186, 29352769432, 22526716039, 8657891549, 11600310388, 11111528394,
                                    31815752357, 17939761522, 31275051856, 26932078361, 15314162869, 44536689124,
                                    23182495639, 41090404835, 25193933355, 37893424312, 21572844261, 42289502373,
                                    6116148906, 30328470391, 3587405463, 43810110050, 34066294725, 42537568085,
                                    21409208392, 20404195361, 2922336307, 26213405772, 5594341034, 758321612,
                                    44821145713, 8717612018, 25047263995, 30762484136, 18602947666, 36330985497,
                                    29069729400, 955880695, 8027227928, 13261521441, 15609277757, 6547112394,
                                    9964160450, 2365761078, 43657251459, 19111227845, 19795308037, 24716229271,
                                    29171867566, 35410174219, 5552777096, 26061078952, 44384252968, 39200844167,
                                    13761097180, 45180013741, 9306808967, 37808306070, 39766435708, 24471320392,
                                    8826868002, 22980478967, 23671183260, 36384373935, 14671197820, 42309160181,
                                    5454788964, 39391733015, 38879105346, 41031398344, 14169264040, 39763904948,
                                    1704645247, 7720538537, 32103087566, 2787666439, 20628666877, 32397855824,
                                    104955438, 26876660816, 26829169612, 4129055236, 34347300569, 26192742054,
                                    26287881822, 39476699596, 23279398068, 19975593832, 19062030802, 39363817453,
                                    20336088090, 43867162508, 26518221712, 37299347274, 22171953027, 14364680684,
                                    31573344604, 30943244844, 6567236848, 2062022959, 5613989248, 40907568409,
                                    44876924808, 21454462160, 36210505419, 21593927740, 14289330258, 18497981221,
                                    36292913183, 26752758854, 21946527042, 30460821707, 42193845745, 1, 38159621225,
                                    29834500982, 11189451259, 23877795104, 620664394, 8219799192, 14475398497,
                                    628024503, 11427851954, 10625635079, 24609267322, 2461160471, 12644296180,
                                    37139111413, 28065196860, 19199842616, 44425538642, 34943492092, 18024625393,
                                    12676926453, 18163770099, 39162667997, 10810798906, 20922289797, 37897661863,
                                    27796446819, 10215709161, 249358786, 22356015293, 3080281428, 9238241737,
                                    30071299550, 21442030039, 45183171626, 8326930851, 25135381977, 31280457830,
                                    37691070486, 16270880477, 38462787260, 9670175475, 29306132688, 38806820834,
                                    8936066573, 11705080374, 34524910750, 11911985491, 18717061293, 2827874886,
                                    10714058222, 12981451520, 40230153737, 419524641, 17599061745, 29122553194,
                                    12406108034, 5019997004, 19770009413, 24186697519, 40006224873, 17135187224,
                                    18364939249, 5247085064, 35069350501, 987994216, 12503155833, 10735208363,
                                    8151538602, 10587609775, 18527359666, 8422575215, 2452024074, 7301400695,
                                    33922037564, 40658996551, 27750317418, 29484747122, 90023669, 33747368959,
                                    29016827781, 20665426239, 30570788495, 24168712258, 26215804295, 4753849312,
                                    37469809745, 4405973025, 38326319736, 43638009130, 4169018440, 25223516030,
                                    37156772663, 22199766178, 17933675997, 19193883491, 5255148713, 13049041119,
                                    38456323099, 7673614148, 26240938804, 30915995563, 14947360051, 10660567562,
                                    21470943679, 12185532972, 5146228021, 33004825355, 15101768449, 34319648485,
                                    14110843197, 33319387828, 42455188907, 19394284982, 5771640848, 33761253540,
                                    35168899897, 20513453269, 31155353203, 2521748017, 36456231956, 21597051690,
                                    23907318487, 8591306524, 8493227103, 26549011840, 35247903047, 9466209810,
                                    25167040307, 23020163683, 14837639082, 42569479880, 41247548874, 22056930076,
                                    40044372851, 35723665649, 20054569688, 21937670567, 26831041234, 7969903346,
                                    33311559715, 5991984398, 28750463286, 18938608186, 29352769432, 22526716039,
                                    8657891549, 11600310388, 11111528394, 31815752357, 17939761522, 31275051856,
                                    26932078361, 15314162869, 44536689124, 23182495639, 41090404835, 25193933355,
                                    37893424312, 21572844261, 42289502373, 6116148906, 30328470391, 3587405463,
                                    43810110050, 34066294725, 42537568085, 21409208392, 20404195361, 2922336307,
                                    26213405772, 5594341034, 758321612, 44821145713, 8717612018, 25047263995,
                                    30762484136, 18602947666, 36330985497, 29069729400, 955880695, 8027227928,
                                    13261521441, 15609277757, 6547112394, 9964160450, 2365761078, 43657251459,
                                    19111227845, 19795308037, 24716229271, 29171867566, 35410174219, 5552777096,
                                    26061078952, 44384252968, 39200844167, 13761097180, 45180013741, 9306808967,
                                    37808306070, 39766435708, 24471320392, 8826868002, 22980478967, 23671183260,
                                    36384373935, 14671197820, 42309160181, 5454788964, 39391733015, 38879105346,
                                    41031398344, 14169264040, 39763904948, 1704645247, 7720538537, 32103087566,
                                    2787666439, 20628666877, 32397855824, 104955438, 26876660816, 26829169612,
                                    4129055236, 34347300569, 26192742054, 26287881822, 39476699596, 23279398068,
                                    19975593832, 19062030802, 39363817453, 20336088090, 43867162508, 26518221712,
                                    37299347274, 22171953027, 14364680684, 31573344604, 30943244844, 6567236848,
                                    2062022959, 5613989248, 40907568409, 44876924808, 21454462160, 36210505419,
                                    21593927740, 14289330258, 18497981221, 36292913183, 26752758854, 21946527042,
                                    30460821707, 42193845745, 5249167227, 22036066414, 14169375782, 19803336169,
                                    13083359868, 16507925254, 29220913662, 3108099426, 36386271308, 45282559829,
                                    347452986, 18117798322, 21767738227, 21940473017, 18490126772, 37168896716,
                                    20732258033, 518116702, 18489813254, 32134268495, 37801889952, 14266538900,
                                    8642690594, 20567140893, 9947706581, 26390177047, 1454462194, 25862108944,
                                    18240737673, 10733844551, 21015827871, 14947036655, 6180356723, 11067943451,
                                    38714487393, 13194199315, 37185698873, 9633232681, 31755026747, 31760905474,
                                    11200498626, 2598656828, 8675421411, 38781972118, 22663741368, 20961051239,
                                    34600886480, 17743029036, 27813811310, 9418296765, 44939611429, 24444238860,
                                    2935994687, 26450089447, 34277027364, 4830894253, 23237159345, 33731065941,
                                    28484145501, 7150712989, 9260584727, 2648416943, 35080090316, 1989606928,
                                    38579250926, 30732745952, 40454195316, 37662786752, 10694171256, 2041538626,
                                    14977512949, 11042025598, 19268881308, 14810708444, 43468262765, 41146343111,
                                    18340247021, 40670359024, 2479784582, 28888534300, 4875035460, 37477559336,
                                    35350792601, 16205304066, 43736028728, 8002702429, 22167402412, 30816499293,
                                    7377010834, 16977078992, 32533458448, 41068160173, 22481709346, 3222081636,
                                    22132147450, 33853703037, 18297796439, 11509758637, 10858396117, 42190802041,
                                    13921638138, 9626138854, 11501198044, 12729149140, 39912743815, 5372359560,
                                    5306769627, 6298154271, 22855443990, 37485515495, 25494888087, 3151428634,
                                    42119796687, 33581042538, 41520191780, 18331184047, 28274115783, 44539909810,
                                    29499885654, 11415817780, 1397840677, 28778530031, 9761031332, 28550473388,
                                    2795655315, 39739400984, 15221283996, 4703464684, 18490286283, 40561730759,
                                    14343067098, 6301801960, 36051361354, 27599248860, 22444200144, 33397196366,
                                    31269031238, 3965703181, 40816204560, 12248763874, 29127628901, 23094021459,
                                    13349815530, 38449112104, 9413089992, 9739245327, 40759164288, 11419711575,
                                    33801192842, 5927637841, 12971125435, 19213932353, 39626010590, 20981486899,
                                    10647908770, 12747957772, 13966653080, 8375716167, 33017319037, 23163270002,
                                    25652131339, 41855793388, 37409469840, 4078190828, 29589923993, 27885593380,
                                    30652735110, 29555096884, 41122706021, 21617504765, 9623722630, 28889439646,
                                    36301988604, 2769234016, 11166759043, 17067802404, 17522267412, 29199431075,
                                    20014891617, 14042745902, 43522972503, 41318773385, 10187918928, 38968259185,
                                    7334184592, 13400495788, 31670706066, 22816194032, 42501196570, 6326815055,
                                    24824970980, 3994224830, 38381048949, 23588227309, 45366354080, 4963896438,
                                    7720123527, 34634197545, 28264512795, 39250656829, 42317696820, 13392072909,
                                    14864461492, 18413634882, 40543741657, 32931453208, 35146967622, 43820822762,
                                    18420527014, 13918631478, 25695966640, 43559233511, 36716192772, 41213968249,
                                    9692757489, 2693830549, 7747037235, 23499426829, 27897514598, 32901112675,
                                    13785995925, 18487302758, 25238467247, 16904606832, 30215887059, 21861367419,
                                    37656227792, 10662382583, 29459198447, 25255373456, 3996951822, 35597318679,
                                    5642745311, 20235235272, 12186028230, 21174052168, 16234835514, 36629150905,
                                    12206003485, 44649064226, 9847635637, 16464218302, 11966842242, 40754443246,
                                    15391806604, 39664510500, 45467041139, 19111639613, 22547640852, 43213432648,
                                    30870890158, 13758779585, 19503783922, 31524720189, 39131333119, 3204673454};


static uint64_t modmul(uint64_t a, uint64_t b) {
    return (((__uint128_t) a * (__uint128_t) b) % (__uint128_t) APON_Q);
}

static void ntt(const uint64_t *roots, uint64_t *x) {

    //Cooley-Tukey NTT (ish)

    uint64_t m, i, j, k, t;
    uint64_t S, U, V;
    t = 512;

    m = 1;
    while (m < 1024) {
        k = 0;
        for (i = 0; i < m; i++) {
            S = roots[m + i];
            for (j = k; j < k + t; j++) {
                U = x[j];
                V = modmul(x[j + t], S);
                x[j] = modq_64(U + V);
                x[j + t] = modq_64(U + 2 * APON_Q - V);
                //x[j + t] = U - V;
            }
            k += 2 * t;
        }
        t >>= 1;
        m <<= 1;
    }
}


static void invntt(const uint64_t *iroots, uint64_t *x) {

    // Gentleman-Sande INTT (ish)

    uint64_t m, i, j, k, t;
    t = 1;
    uint64_t S, U, V, W;

    m = 512;

    while (m > 0) {
        k = 0;
        for (i = 0; i < m; i++) {
            S = iroots[m + i];
            for (j = k; j < k + t; j++) {
                U = x[j];
                V = x[j + t];
                x[j] = modq_64(U + V);
                W = modq_64(U - V);
                x[j + t] = modmul(W, S);
                //printf("j + t = %lu\n", j + t);
            }
            k += 2 * t;
        }
        t <<= 1;
        m >>= 1;
    }

    for (i = 0; i < 1024; i++) {
        x[i] = modmul(x[i], N_INVERSE);
    }
}


void convolution(const uint64_t *a, const uint64_t *b, uint64_t *res) {

    uint64_t a_copy[APON_N], b_copy[APON_N];

    memcpy(a_copy, a, sizeof(uint64_t) * APON_N);
    memcpy(b_copy, b, sizeof(uint64_t) * APON_N);


    ntt(omega, a_copy);
    ntt(omega, b_copy);

    int i;
    for (i = 0; i < 1024; ++i) {
        res[i] = modmul(a_copy[i], b_copy[i]);
    }

    invntt(omega_inv, res);
}